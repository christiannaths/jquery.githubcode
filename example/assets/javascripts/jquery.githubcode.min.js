;(function(a,b,c){var g,h,e={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,f,g,h,i,j="",k=0;for(a=e._utf8_encode(a);a.length>k;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),f=b>>2,g=(3&b)<<4|c>>4,h=(15&c)<<2|d>>6,i=63&d,isNaN(c)?h=i=64:isNaN(d)&&(i=64),j=j+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h)+this._keyStr.charAt(i);return j},decode:function(a){var b,c,d,f,g,h,i,j="",k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");a.length>k;)f=this._keyStr.indexOf(a.charAt(k++)),g=this._keyStr.indexOf(a.charAt(k++)),h=this._keyStr.indexOf(a.charAt(k++)),i=this._keyStr.indexOf(a.charAt(k++)),b=f<<2|g>>4,c=(15&g)<<4|h>>2,d=(3&h)<<6|i,j+=String.fromCharCode(b),64!=h&&(j+=String.fromCharCode(c)),64!=i&&(j+=String.fromCharCode(d));return j=e._utf8_decode(j)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;a.length>c;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(192|d>>6),b+=String.fromCharCode(128|63&d)):(b+=String.fromCharCode(224|d>>12),b+=String.fromCharCode(128|63&d>>6),b+=String.fromCharCode(128|63&d))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;a.length>c;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}},f={parse:function(a){var b=c.createElement("a");return b.href=a,b}};g="githubcode",h={ref:"master",access_token:"f23b79399a2c6fbb411643ce79ad60029c853b97",request_host:"https://api.github.com/repos",beforeInsert:function(){},afterInsert:function(){}};var i=function(b,c){var f,d=this,e=a(b);this.options=a.extend({},h,c),this.element=b,this.$element=e,this._defaults=h,this._name=g,this.url=this.$element.data("url"),this.api=this.$element.data("api"),this.init(),f=this.githubRequest(this.api.request_url),f.done(this.options.beforeInsert),f.done(function(a){d.$inserted_elements=d.insert(a,e,d)}),f.done(function(){d.options.afterInsert(d.$inserted_elements)}),f.fail(function(c,d){a(b).replaceWith(a("<pre></pre>").text(c.status+" "+d))})};i.prototype={init:function(){this.api=this.constructRequestUrl()},githubRequest:function(b){var c=new a.Deferred;return b?c=a.get(b):c.reject({status:"403 rejected:"},"Cannot process this URL"),c},insert:function(b,c,d){var e=a([]),f=d.gatherContent(b,d);return a.each(f.files,function(b,d){var f=a("<pre/>"),g=a("<code/>");f=f.clone(),g=g.clone(),g.text(d.content),f.addClass("language-"+d.language),f.addClass("lang-"+d.language),f.attr("data-language",d.language),f.attr("data-lang",d.language),f.append(g),e=e.add(f),c.before(f)}),c.remove(),e},gatherContent:function(b,c){var d={files:[]},f=[];return b.files?f=b.files:f.push(b),a.map(f,function(a){tmp={},tmp.filename=a.filename||a.path,tmp.content=a.patch||e.decode(a.content),tmp.language=c.detectLanguage(tmp.filename),c.api.path&&c.api.path===tmp.filename?d.files.push(tmp):c.api.path||d.files.push(tmp)}),d},detectLanguage:function(a){var b=a.split(".").pop(),c={js:"javascript",css:"css",sass:"sass",scss:"scss",html:"markup","htm ":"markup",md:"markup",svg:"markup",coffee:"coffeescript",php:"php"};return c[b]},constructRequestUrl:function(){var b={token:this.options.access_token,request_host:this.options.request_host,ref:this.options.ref,repo:this.options.repo,owner:this.options.owner};return this.url?b=this.parseUrlParams(this.url,b):this.api&&(b=this.parseApiParams(this.api,b)),b.request_url="commit"!==b.method||b.path?b.path?[b.request_host,b.owner,b.repo,"contents",b.path].join("/")+"?ref="+b.ref+"&access_token="+b.token:null:[b.request_host,b.owner,b.repo,"commits",b.ref].join("/")+"?access_token="+b.token,b},parseUrlParams:function(a,b){var c=f.parse(a),d=c.pathname.split("/");return b.host=c.host,b.full_path=c.pathname,"raw.github.com"===b.host?(b.owner=d[1],b.repo=d[2],b.ref=d[3],b.path=d.slice(4,d.length).join("/")):(b.owner=d[1],b.repo=d[2],b.method=d[3],b.ref=d[4],b.path=d.slice(5,d.length).join("/")||null),b},parseApiParams:function(b,c){return b=b.replace(/\s+/g,""),b=b.split(","),a.each(b,function(a,b){b=b.split(":"),c[b[0]]=b[1]}),c.ref=c.commit||c.tag||c.ref||this.options.ref,"commit"in c&&(c.method="commit"),console.log(c),c}},a.fn[g]=function(b){return this.each(function(){a.data(this,"plugin_"+g)||a.data(this,"plugin_"+g,new i(this,b))})}})(jQuery,window,document);
